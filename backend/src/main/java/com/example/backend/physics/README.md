# 物理引擎-版本二

## 总概

版本2中添加了物理引擎剩余所有需求的功能

对诸如三角形放大，旋转等问题进行了修正



其中所有的类在创建时，所需传递的参数都是指组件的左上角坐标了

现在tostring传递的位置数据是世界坐标数据(世界大小的800x800只是给jpanel测试的时候用的)

实际上的世界坐标，由于原来的RATE = 10，所以原先是80x80。

但之前yy加了一个LENGTH常量，所以现在就都根据这个常量来构建世界，因此现在世界的坐标是20x20。而之前的球类等类的tostring给的坐标数据都是除完了LENGTH的给法，现在改为直接给世界坐标了(考虑到前后端原点的不一致，给的y轴坐标是经过颠倒的)，如果原先的服务端部分在取参时是要乘上LENGTH的话，现在就不需要了，这点需要注意更改。这一点与最新的文档要求已经变为一致

当然,tostring现在传递的也不是组件的原本位置，而是组件的左上角位置



现在球类正方体三角形类等默认创建时的半径/半宽/半高都默认是0.5f了，除了Baffle运动隔板

去掉了worldconstant当中的RATE，改为使用LENGTH

## 具体实现及说明

### 球类

​	无大改变，需要注意的是现在创建的球半径实际上会比显示半径小一些(为了保证球进得去轨道，如果半径和格子一样大是进不去轨道的)

​	变更了tostring的返回内容，具体说明如总概

### 三角形类，正方体类，圆类

修正了旋转和创建的错误问题，现在默认创建后与ReadMe中图片一致，现在旋转是

### GizmoWorldEdge

世界边缘类，就是框住世界的边缘，有两个构造函数，建议直接使用无参构造函数，有参构造函数传入的参数除了id都无意义，此类半宽半高均为10，因此刚好框住整个棋盘.

### GizmoPipe

包含直Pipe和弯Pipe，直pipe默认创建竖直的，弯Pipe默认创建圆心为左下角。

直管道:

球是没法通过管壁进入管道的，实际上由于弹力设置得较高(基本不会因为弹而损失能量)，如果球没对准管道是根本进不去的,

不可放大缩小，可以旋转，tostring方法最后会返回一个1或0，1为管道竖直，0为管道水平

弯管道：

由于球的弹力设置得很高，在对弯管进行微调后，实际上球在管道里基本不会损失能量，弯管道现在就是直接改变球的运动方向

不可放大缩小，可以旋转，tostring方法最后会返回0123，0为弯管圆心在左下角，每次递增则代表其逆时针旋转一次



### GizmoBaffle

隔板类

左隔板和右隔板的区别在于隔板当中有一个布尔变量ifLeft，为真是代表是左隔板，否则为右

在隔板在世界中真正初始化时，有两种方式，分别是动力学方式和动态方式，动力学方式不符合要求，因为动力学组件无法与静态组件产生碰撞。

因此现在的实现方法为：隔板为动态组件(和球一致)，只不过:

1.不受重力影响 2.质量奇大 3.无弹性 4.无摩擦力，所以球的碰撞对其不会产生位移影响，其也可以保证碰到球时，球会。



有三个设置隔板方位的接口，分别为setSpeed stopBaffle和setPosition

这里强烈建议使用setSpeed，因为在任何物理引擎中，使用setPosition是直接将组件的位置置于指定位置而不会管此位置是否已有组件，因此直接设置隔板的位置会导致隔板碰到其他组件时产生严重抖动，这一点在诸如unity等成熟引擎里都是一样的。

Baffle的tostring方法最后会返回一个bool值，其标志着此板是否为左隔板



### GizmoBlackhole

黑洞没有碰撞箱

黑洞只会吸引球

黑洞的吸引力定义在黑洞类中，是一个公开属性，可以手动调整

黑洞的逻辑函数不在黑洞类中，这是因为在设计物理类之初，并没有给组件指定管理其的worldmanager，因此黑洞的逻辑函数在worldmanager当中，由于此引擎不存在事件系统，因此此函数需要每帧都手动调用。

球离黑洞越近，吸引力越大。

需要传入的两个参数分别为开始吸引球的距离，和摧毁球的距离



### WorldManager

新增getBall函数，返回第一个找到的球

新增getBlackHole函数，返回第一个找到的黑洞

新增getLeft(Right)Baffle函数，返回第一个找到的左（右）隔板

以上get函数若找不到都返回null



新增attractBallToBlackHole函数，即如上黑洞部分所述的函数，黑洞的吸引与摧毁逻辑都在其中执行。需要传入的参数为开始吸引距离与摧毁距离，建议为3, 0.8

新增clearWorld函数，如字面意义，清除所有的组件

测试用函数现在结尾都为Test，不需要管



